<!DOCTYPE html>
<html>
<head>
    <title>Techmark Admin</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div id="adminHeader">
    <div id="adminlogo"><img src="../img/techmarkLogoNoText.svg" alt="techmark Logo">
    <h1>Welcome Admin</h1>
    </div>
    <div id="adminMenu">
        <a>Help</a>
        <a>Settings</a>
        <a>Logout</a>
    </div>
</div>

<div id="adminPage">
    <div class="admMain">
            <!-- The tabs -->
            <input id="tab1" type="radio" name="tabs" checked>
            <label for="tab1">Events</label>

            <input id="tab2" type="radio" name="tabs">
            <label for="tab2">Partners</label>

            <input id="tab3" type="radio" name="tabs">
            <label for="tab3">Add Events</label>

            <input id="tab4" type="radio" name="tabs">
            <label for="tab4">Add Partners</label>

            <input id="tab5" type="radio" name="tabs">
            <label for="tab5">Add Users</label>

            <!-- Tab content -->
        <div class="admContent">
            <div id="events">


            </div>

            <div id="partners">
                

            </div>


            <div id="AddEvents">
                <div class="row">
                    <div class="admEdit">
                        <section>
                        <form id="frm-create-event" enctype="multipart/form-data">
							<input type="input" name="title" placeholder="title">
							<input type="input" name="tag" placeholder="tag"> 
							<input type="textarea" name="description" placeholder="Description">
							<input type="input" name="location" placeholder="location">
							<input type="input" name="price" placeholder="price">
							<input type="date" name="date">
							<input type="file" name="image">
						<button id="btn-create-event" type="submit">Create event</button>
						</form>
                        </section>
                    </div>
                </div>
            </div>

            <div id="AddPartners">
                <div class="row">
                    <div class="admEdit">
                        <section>
						<form id="frm-create-partner" enctype="multipart/form-data">
							<input type="input" name="name" placeholder="name">
							<input type="input" name="website" placeholder="website"> 
							<input type="input" name="mail" placeholder="mail">
							<input type="file" name="image">
							<button id="btn-create-partner" type="submit">Create Partner</button>
						</form>
                        </section>

                    </div>
                </div>
            </div>

            <div id="AddUser">
                <div class="row">
                    <section>
						<form id="frm-create-user" enctype="multipart/form-data">
							<input type="input" name="username" placeholder="username">
							<input type="input" name="password" placeholder="password"> 
							<button id="btn-create-user" type="submit">Create User</button>
						</form>
                    </section>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="../js/login.js"></script>

<script>

//Grab events when page loads.

fnGetAllEvents();
fnGetAllPartners();

function fnGetAllEvents(){

        var sEvent = '<div class="row">\
                             <time datetime="{{eventdatecalender}}" class="icon">\
                             <strong>September</strong>\
                             <span>20</span>\
                             <em>Saturday</em>\
                             </time>\
                             <span class="eventID">{{eventid}}</span>\
                             <span>{{eventtitle}}</span>\
                             <span>{{eventdate}}</span>\
                             <span>{{eventprice}}</span>\
                            <div>\
                            <button>Edit</button>\
                            <button class="btnDeleteEvent">Delete</button>\
                   </div>\
               </div>';

    var sURL = "api/api-get-all-events.php";

    $.getJSON(sURL, function(jData){

        $("#events").empty(); //clear before appending.
        for(var i = 0; i < jData.length; i++){
            var sEventTemplate = sEvent;
            sEventTemplate = sEventTemplate.replace( "{{eventdatecalender}}", jData[i].sDate);
            sEventTemplate = sEventTemplate.replace( "{{eventid}}", jData[i].sID);
            sEventTemplate = sEventTemplate.replace( "{{eventtitle}}", jData[i].sTitle);
            sEventTemplate = sEventTemplate.replace( "{{eventdate}}", jData[i].sDate);
            sEventTemplate = sEventTemplate.replace( "{{eventprice}}", jData[i].sPrice);
            $("#events").append(sEventTemplate);
        };
    });
}

function fnGetAllPartners(){

        var sPartner = '<div class="row">\
                            <div>\
                                <img src="../img/events/{{partnerlogo}}">\
                            </div>\
                            <span class="partnerID">{{partnerid}}</span>\
                            <span>{{partnername}}</span>\
                            <span>{{partnerwebsite}}</span>\
                            <span>{{partnermail}}</span>\
                            <div>\
                               <button>Edit</button>\
                               <button class="btnDeletePartner">Delete</button>\
                            </div>\
                        </div>';

    var sURL = "api/api-get-all-partners.php";

    $.getJSON(sURL, function(jData){

        $("#partners").empty(); //clear before appending.
        for(var i = 0; i < jData.length; i++){
            var sPartnerTemplate = sPartner;
            sPartnerTemplate = sPartnerTemplate.replace( "{{partnerid}}", jData[i].sID);
            sPartnerTemplate = sPartnerTemplate.replace( "{{partnername}}", jData[i].sPartnerName);
            sPartnerTemplate = sPartnerTemplate.replace( "{{partnerwebsite}}", jData[i].sPartnerWebsite);
            sPartnerTemplate = sPartnerTemplate.replace( "{{partnermail}}", jData[i].sPartnerMail);
            sPartnerTemplate = sPartnerTemplate.replace( "{{partnerlogo}}", jData[i].sPartnerLogo);
            $("#partners").append(sPartnerTemplate);
        };
    });
}

$('#frm-create-event').on('submit',(function(e) {
	//e.preventDefault(); // do not reload
	var formData = new FormData(this); // this is the form and it's data
	console.log(formData);
	$.ajax({
        type:'POST',
        url: "api/api-create-event.php",
        data: formData,
        cache:false,
        contentType: false, // ?
        processData: false, // ?
	}).done(function(jData){
		console.log("Hi");
	})
	})
);

$('#frm-create-partner').on('submit',(function(e) {
	//e.preventDefault(); // do not reload
	var formData = new FormData(this); // this is the form and it's data
	console.log(formData);
	$.ajax({
        type:'POST',
        url: "api/api-create-partner.php",
        data: formData,
        cache:false,
        contentType: false, // ?
        processData: false, // ?
	}).done(function(jData){
		console.log("Hi");
	})
	})
);
$('#frm-create-user').on('submit',(function(e) {
	//e.preventDefault(); // do not reload
	var formData = new FormData(this); // this is the form and it's data
	console.log(formData);
	$.ajax({
        type:'POST',
        url: "api/api-create-user.php",
        data: formData,
        cache:false,
        contentType: false, // ?
        processData: false, // ?
	}).done(function(jData){
		console.log("Hi");
	})
	})
);

$(document).on("click",".btnDeleteEvent", function(jData){

    var sIDToDelete = $(this).parent().siblings(".eventID").text();
    var sURL = "api/api-delete-event.php?id="+sIDToDelete;
    var oTheParent = $(this).parent().parent();

    $.get(sURL, function(){
        $(oTheParent).fadeOut(200);
        console.log("Event #"+sIDToDelete+" deleted!")
    });

});

$(document).on("click",".btnDeletePartner", function(jData){

    var sIDToDelete = $(this).parent().siblings(".partnerID").text();
    var sURL = "api/api-delete-partner.php?id="+sIDToDelete;
    var oTheParent = $(this).parent().parent();

    $.get(sURL, function(){
        $(oTheParent).fadeOut(200);
        console.log("Partner #"+sIDToDelete+" deleted!")
    });

});


</script>

</body>
</html>